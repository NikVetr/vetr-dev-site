<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Palette Extender</title>
  <link rel="icon" href="assets/palette-town_favicon2.png">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <main class="page">
    <header class="hero">
      <div class="hero-text">
        <style>
        </style>
    
        <p class="eyebrow-title">
          <span class="c-1">P</span><span class="c-2">a</span><span class="c-3">l</span><span class="c-4">e</span><span
            class="c-5">t</span><span class="c-6">t</span><span class="c-7">e</span>
          <span class="c-8">T</span><span class="c-9">o</span><span class="c-10">w</span><span class="c-11">n</span>
        </p>
    
        <h1 class="long-title">
          traversing <span class="c-1">P</span>erceptu<span class="c-2">A</span>lly uniform co<span
            class="c-3">L</span>orspaces to
          <span class="c-4">E</span>nhance and ex<span class="c-5">T</span>end discre<span class="c-6">T</span>e color
          palett<span class="c-7">E</span>s for
          <span class="c-8">T</span>richromatic and c<span class="c-9">O</span>lor vision deficient discriminability
          <span class="c-10">W</span>ith joi<span class="c-11">N</span>t optimization
        </h1>
    
        <p class="subhead">
          Choose your starter palette, train their parameters, and watch your team evolve into a champion color scheme.
        </p>
      </div>
    
      <div class="actions">
        <button id="run-btn" class="primary">RUN</button>
        <button id="reset-btn" class="ghost">RESET</button>
        <div class="undo-redo-row">
          <button id="undo-btn" class="ghost" type="button">UNDO</button>
          <button id="redo-btn" class="ghost" type="button">REDO</button>
        </div>
      </div>
    </header>

    <section class="layout">
      <div class="controls stack">
        <div class="control-block wide">
          <label for="palette-input">Input Colors (Hex)</label>
          <div class="palette-input-wrap">
            <pre id="palette-highlight" aria-hidden="true"></pre>
            <textarea id="palette-input" rows="3" spellcheck="false" placeholder="eg, #E64B35, #4DBBD5, #00A087, #3C5488, ..."></textarea>
          </div>
          <div class="palette-clear-row">
            <button id="palette-clear" type="button" class="ghost palette-clear">Clear</button>
          </div>
          <div class="palette-buttons">
            <div id="palette-groups"></div>
            <button id="palette-more" type="button" class="palette-btn palette-more">More ▾</button>
          </div>
        </div>

        <div class="control-block">
          <h3>Algorithm Settings</h3>
          <div class="field">
            <label for="seed-input">Seed</label>
            <input id="seed-input" type="text" inputmode="numeric" pattern="-?\\d*" placeholder="random" value="random">
          </div>
          <div class="field">
            <label for="color-space">Optimization colorspace</label>
            <select id="color-space">
              <option value="oklab">OKLab</option>
              <option value="oklch">OKLCh</option>
              <option value="lab">Lab</option>
              <option value="luv">Luv</option>
              <option value="lch">LCh</option>
              <option value="hsl">HSL</option>
              <option value="jzazbz">JzAzBz</option>
            </select>
          </div>
          <div class="field three-col mini gamut-row">
            <div class="clip-inline">
              <div class="clip-inline-label">Clip to Gamut:</div>
              <div class="clip-inline-cols">
                <div class="clip-inline-col">
                  <div class="clip-inline-title">Visual</div>
                  <input id="clip-gamut" type="checkbox" aria-label="Clip to gamut for visualization">
                </div>
                <div class="clip-inline-col">
                  <div class="clip-inline-title">Optim</div>
                  <input id="clip-gamut-opt" type="checkbox" aria-label="Clip to gamut for optimization">
                </div>
              </div>
            </div>
            <div class="gamut-select">
              <label for="gamut-preset">Preset</label>
              <select id="gamut-preset">
                <option value="srgb">sRGB</option>
                <option value="display-p3">Display P3</option>
                <option value="rec2020">Rec. 2020</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label for="cvd-model">Discriminability model</label>
            <select id="cvd-model">
              <option value="machado2009">Machado 2009 (linear RGB)</option>
              <option value="legacy">Legacy (gamma RGB matrix)</option>
            </select>
          </div>
          <input id="raw-input-values" type="hidden">
          <div class="field">
            <label for="distance-metric">Distance metric</label>
            <select id="distance-metric">
              <option value="de2000">ΔE2000 (Lab)</option>
              <option value="oklab76">ΔE76 (Euclidean in OKLab)</option>
              <option value="lab76">ΔE76 (Euclidean in Lab)</option>
              <option value="cam02ucs">CAM02-UCS (Luo 2006)</option>
              <option value="cam16ucs">CAM16-UCS (Li 2017)</option>
              <option value="deitp">ΔE_ITP (BT.2124, ICtCp)</option>
            </select>
          </div>
          <div class="field">
            <label for="mean-type">Distance aggregation</label>
            <select id="mean-type">
              <optgroup label="-- recommended --">
                <option value="harmonic">Harmonic mean</option>
                <option value="lehmer">Lehrer mean</option>
                <option value="power">Power mean</option>
                <option value="minimum">Minimum (worst-case)</option>
              </optgroup>
              <optgroup label="-- not recommended --">
                <option value="geometric">Geometric mean</option>
                <option value="arithmetic">Arithmetic mean</option>
                <option value="quadratic">Quadratic mean (RMS)</option>
              </optgroup>
            </select>
          </div>
          <div class="field" id="mean-p-row" hidden>
            <label for="mean-p">p</label>
            <div class="inline-row compact between">
              <input id="mean-p" type="range" min="-10" max="10" step="0.1" value="-2">
              <span id="mean-p-val" class="result-chip">-2.0</span>
            </div>
          </div>
          <div class="field two-col">
            <div>
              <label for="colors-to-add">Colors to add</label>
              <input id="colors-to-add" type="number" min="1" max="8" value="3">
            </div>
            <div>
              <label for="optim-runs">Restarts</label>
              <input id="optim-runs" type="number" min="5" max="200" value="100">
            </div>
          </div>
          <div class="field">
            <label for="nm-iters">Nelder–Mead iterations</label>
            <input id="nm-iters" type="number" min="50" max="1000" value="100">
          </div>
          <div class="field two-col">
            <div>
              <label for="constraint-topology">Constraint topology</label>
              <select id="constraint-topology">
                <option value="contiguous">Contiguous</option>
                <option value="discontiguous">Discontiguous</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div>
              <label for="aesthetic-mode">Aesthetic centers</label>
              <select id="aesthetic-mode">
                <option value="none">None</option>
                <option value="complementary">Complementary</option>
                <option value="triadic">Triadic</option>
                <option value="tetradic">Tetradic</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label>constraint widths</label>
            <div class="field three-col mini">
              <div class="constraint-row">
                <div class="constraint-head">
                  <label id="w-h-label" for="w-h">h</label>
                  <div class="constraint-toggle">
                    <span>Hard</span>
                    <label class="switch">
                      <input id="mode-h" type="checkbox" aria-label="Toggle soft constraint for H">
                      <span class="switch-slider"></span>
                    </label>
                    <span>Soft</span>
                  </div>
                </div>
                <input id="w-h" type="range" min="0" max="1" step="0.001" value="0">
                <span id="w-h-val" class="value-chip">0.0%</span>
              </div>
              <div class="constraint-row">
                <div class="constraint-head">
                  <label id="w-sc-label" for="w-sc">s/c</label>
                  <div class="constraint-toggle">
                    <span>Hard</span>
                    <label class="switch">
                      <input id="mode-sc" type="checkbox" aria-label="Toggle soft constraint for S/C">
                      <span class="switch-slider"></span>
                    </label>
                    <span>Soft</span>
                  </div>
                </div>
                <input id="w-sc" type="range" min="0" max="1" step="0.001" value="0">
                <span id="w-sc-val" class="value-chip">0.0%</span>
              </div>
              <div class="constraint-row">
                <div class="constraint-head">
                  <label id="w-l-label" for="w-l">l</label>
                  <div class="constraint-toggle">
                    <span>Hard</span>
                    <label class="switch">
                      <input id="mode-l" type="checkbox" aria-label="Toggle soft constraint for L">
                      <span class="switch-slider"></span>
                    </label>
                    <span>Soft</span>
                  </div>
                </div>
                <input id="w-l" type="range" min="0" max="1" step="0.001" value="0">
                <span id="w-l-val" class="value-chip">0.0%</span>
              </div>
            </div>
          </div>
          <div class="field constraint-individual-toggle" id="constraint-individual-row">
            <button id="constraint-individual-toggle" type="button" class="constraint-expander" aria-expanded="false">
              Per-color constraints
            </button>
          </div>
          <div class="field constraint-individual-panel" id="constraint-individual-panel" hidden>
            <div id="constraint-individual-list" class="constraint-individual-list"></div>
          </div>
          <div class="field inline-row between bg-row">
            <label class="inline small">
              <input id="bg-enabled" type="checkbox" checked>
              Background Color:
            </label>
            <label for="bg-color" class="bg-chip">
              <input id="bg-color" type="color" value="#ffffff" aria-label="Background color picker">
            </label>
          </div>
          <div class="field inline-row">
            <label class="inline small">
              <input id="verbose-toggle" type="checkbox">
              Verbose
            </label>
          </div>
          <div class="field">
            <div class="inline-row between">
              <label for="colorwheel-space">Visualization colorspace</label>
              <label class="inline small">
                <input id="sync-colorspaces" type="checkbox" checked>
                synchronize
              </label>
            </div>
            <select id="colorwheel-space">
              <option value="hsl">HSL</option>
              <option value="lch">LCh</option>
              <option value="oklch">OKLCh</option>
              <option value="lab">Lab</option>
              <option value="luv">Luv</option>
              <option value="oklab">OKLab</option>
              <option value="jzazbz">JzAzBz</option>
            </select>
          </div>
          <div class="field">
            <label for="gamut-mode">Gamut for visualization</label>
            <select id="gamut-mode">
              <option value="auto">auto (fit to palette)</option>
              <option value="full">full colorspace</option>
            </select>
          </div>
        </div>

        <div class="control-block">
          <h3>Color Vision Prioritization Weights</h3>
          <div class="field four-col mini">
            <div>
              <label for="w-none">trichrom</label>
              <input id="w-none" type="range" min="0" max="100" step="0.1" value="50">
              <span id="w-none-val" class="value-chip">50.0%</span>
            </div>
            <div>
              <label for="w-deutan">deutan</label>
              <input id="w-deutan" type="range" min="0" max="100" step="0.1" value="40">
              <span id="w-deutan-val" class="value-chip">40.0%</span>
            </div>
            <div>
              <label for="w-protan">protan</label>
              <input id="w-protan" type="range" min="0" max="100" step="0.1" value="8">
              <span id="w-protan-val" class="value-chip">8.0%</span>
            </div>
            <div>
              <label for="w-tritan">tritan</label>
              <input id="w-tritan" type="range" min="0" max="100" step="0.1" value="2">
              <span id="w-tritan-val" class="value-chip">2.0%</span>
            </div>
          </div>
        </div>
      </div>

      <div class="right-side">
        <div class="result-nav" id="result-nav">
          <div class="result-nav-left">
            <button id="result-prev" type="button" aria-label="Previous result" class="result-nav-btn">‹</button>
            <div class="result-nav-center">
              <span>#</span>
              <input id="result-rank" type="number" min="1" value="1" aria-label="Result rank">
              <span>Best Result</span>
              <span id="result-total" class="result-total">(of 0)</span>
              <span id="result-rank-all" class="result-rank-all">#—/—</span>
            </div>
            <button id="result-next" type="button" aria-label="Next result" class="result-nav-btn">›</button>
          </div>
          <div class="result-nav-meta">
            <span id="result-score" class="result-chip">Score: —</span>
            <span id="result-worst" class="result-chip">Worst color: —</span>
            <div class="uniqueness-control" aria-label="Uniqueness filter">
              <label for="uniqueness" class="uniqueness-label">uniqueness</label>
              <input id="uniqueness" type="range" min="0" max="100" step="1" value="0">
              <span id="uniqueness-val" class="result-chip">0%</span>
            </div>
            <span id="clip-gamut-warning" class="clip-warning" hidden>
              Note: constraints are applied in the raw optimization space; gamut clipping for visualization can move the displayed point outside the dashed constraint outline.
            </span>
          </div>
        </div>
        <section id="panels" class="panels"></section>
        <div class="status-col">
          <div class="control-block status" id="status-block">
          <h3>Status: <span id="status-state" class="status-state">Waiting to run</span></h3>
          <div class="progress">
            <div id="progress-bar"></div>
          </div>
          <canvas id="status-graph" height="150"></canvas>
          <label class="small" style="margin-top: 8px; display: block;">Optimization Paths</label>
          <canvas id="status-mini" height="200"></canvas>
          <p id="status-text" class="status">waiting to start…</p>
          <div id="error-text" class="error"></div>
        </div>

          <div class="control-block status">
            <h3>Results</h3>
            <div class="field">
              <label for="results-box">New hex codes</label>
              <textarea id="results-box" rows="2" readonly></textarea>
            </div>
            <div class="field inline-row compact">
              <label class="inline small">
                <input id="format-quotes" type="checkbox">
                quotes
              </label>
              <label class="inline small">
                <input id="format-commas" type="checkbox" checked>
                commas
              </label>
              <label class="inline small">
                <input id="format-lines" type="checkbox">
                newline
              </label>
              <label class="inline small">
                <input id="format-r-c" type="checkbox">
                c()
              </label>
              <label class="inline small">
                <input id="format-py-list" type="checkbox">
                []
              </label>
              <label class="inline small">
                <input id="format-include-inputs" type="checkbox">
                +inputs
              </label>
            </div>
            <div class="results-row">
              <button id="send-to-input-btn" class="ghost" type="button">Send to Input</button>
              <button id="copy-btn" class="ghost" type="button">Copy</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="verbose-panel" class="control-block verbose-panel" style="display:none;">
      <h3>Verbose Runs</h3>
      <div id="verbose-table"></div>
    </section>
  </main>
  <script type="module" src="main.js"></script>
</body>
</html>
